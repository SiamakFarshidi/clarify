{"name": "eda security master analysis ", "full_name": " h1 Security Master Analysis h1 Why Sec Master Analysis h3 What are some questions we want to answer h2 Making time series features when rows dates are missing h1 Takeaways ", "stargazers_count": 0, "forks_count": 0, "description": " Security Master Analysis by marketneutral Why Sec Master Analysis Before you do anything exciting in financial data science you need to understand the nature of the universe of assets you are working with and how the data is presented otherwise garbage in garbage out A security master refers to reference data about the lifetime of a particular asset tracking ticker changes name changes etc over time In finance raw information is typically uninteresting and uninformative and you need to do substantial feature engineering and create either or both of time series and cross sectional features However to do that without error requires that you deeply understand the nature of the asset universe This is not exciting fancy data science but absolutely essential Kaggle competitions are usually won in the third or fourth decimal place of the score so every detail matters What are some questions we want to answer Is assetCode a unique and permanent identifier If you group by assetCode and make time series features are you assured to be referencing the same instrument In the real world the ticker symbol is not guaranteed to refer to the same company over time Data providers usually provide a permanent ID so that you can keep track of this over time This is not provided here although in fact both Intrinio and Reuters provide this in the for sale version of the data used in this competition The rules state Each asset is identified by an assetCode note that a single company may have multiple assetCodes Depending on what you wish to do you may use the assetCode assetName or time as a way to join the market data to news data assetCode object a unique id of an asset So is it unique or not and can we join time series features always over time on assetCode What about assetName Is that unique or do names change over time assetName category the name that corresponds to a group of assetCodes These may be Unknown if the corresponding assetCode does not have any rows in the news data What is the nature of missing data What does it mean when data is missing Let s explore and see http Let s define a valid has data day for each asset if there is reported trading volume for the day And let s see how long an asset is alive by the the distance betwen the first reported data point and last and the number of days in that distance that actually has data This was shocking to me There are very many assets that only exist for say 50 days or less When we look at the amount of data in these spans it is even more surprising Let s compare the asset lifetimes with the amout of data in those lifetime Here I calculate the difference between the number of business days in each span and the count of valid days sorted by most missing data For example ticker VNDA O has its first data point on 2007 02 23 and its last on 2016 12 22 for a span of 2556 business days However in that 2556 days there are only 115 days that actually have data It s not the case that VNDA O didn t exist during those times we just don t have data Looking across the entire dataset however things look a little better Now let s look at whether tickers change over time Is either assetCode or assetName unique So there are a number of companies that have more than 1 assetCode over their lifetime For example T Mobile US Inc And we can trace the lifetime of this company over multiple assetCodes The company started its life as PCS N was merged with TMUS N NYSE listed and then became Nasdaq listed In this case if you want to make long horizon time based features you need to join on assetName One gotcha I see is that don t think that assetName is correct point in time This is hard to verify without proper commercial security master data but I don t think that the actual name of this company in 2007 was T Mobile it was something like Metro PCS T Mobile acquired MetroPCS on May 1 2013 google search when did t mobile acquire MetroPCS You can see this data matches with the lifetimes dataframe subset above Therefore the assetName must not be point in time rather it looks like assetName is the name of the company when this dataset was created for Kaggle recently and then backfilled However it would be very odd for the Reuters News Data to not be point in time Let s see if we can find any news on this company back in 2007 What s fascinating here is that you can see in the article headlines that the company is named correctly point in time as MetroPCS Communications Inc however the assetName is listed as T Mobile US Inc So the organizers have also backfilled today s assetName into the news history This implies that you cannot use NLP on the headline field in any way to join or infer asset clustering However assetName continues to look like a consistent choice over time for a perm ID What about the other way around Is assetName a unique identifier In the real world companies change their names all the time a hilarious example of this is here https www businessinsider com long blockchain company iced tea sec stock 2018 8 What about in this dataset YES We can conclude that since no assetCode has ever been linked to more than assetName that assetName could be a good choice for a permanent identifier It is possible that a company changed its ticker and it s name on the same day and therefore we would not be able to catch this but let s assume this doesn t happen However here is a major gotcha dual class stock Though not very common some companies issue more than one class of stock at the same time Likely the most well know is Google called Alphabet Inc for its full life in this dataset another is Comcast Corp Because of this overlapping data there is no way to be sure about how to link assets over time You are stuck with one of two bad choices link on assetCode and miss ticker changes and corporate actions or link on assetName but get bad output in the case of dual class shares Making time series features when rows dates are missing Let s say you want to make rolling window time series feature like a moving average on volume As we saw above it is not possible to do this 100 without error because we don t know the permanent identifier we must make a tradeoff between the error of using assetCode or assetName Given that assetCode will never overlap on time and therefore allows using time as an index I choose that here To make a rolling feature it was my initial inclination to try something like Let s see what we got Look at the time index the result makes no sense the rolling average of 20 days spans the missing period of 2007 03 20 and 2009 06 26 which is not right in the context of financial time series Instead we need to account for business days rolling This will not be 100 accurate becuase we don t know exchange holidays but it should be very close To do this correctly you need to roll on business days However pandas doesn t like to roll on business days freq tag B and will throw ValueError 20 BusinessDays is a non fixed frequency The next best thing is to roll on calendar days freq tag D It took me awhile to get this to work as pandas complains a lot on multi idexes this issue https github com pandas dev pandas issues 15584 helped a lot This is much better Note that the default min periods is 1 when you use a freq tag i e 20D to roll on So even though we asked for a 20 day window as long as there is at least 1 data point we will get a windowed average The result makes sense if you look at 2009 06 26 you will see that the rolling average does not include any information from the year 2007 rather it is time aware and since there are 19 missing rows before give the 1 day windowed average Takeaways Security master issues are critical You have to be very careful with time based features because of missing data Long horizon features like say 12m momentum may not produce sufficient asset coverage to be useful becuase so much data is missing The fact that an asset is missing data is not informative in itself it is an artifact of the data collection and delivery process For example you cannot calcuate a true asset age e g hypothesizing that days since IPO is a valid feature and use that as a factor This is unfortunate becuase you may hypothesize that news impact is a bigger driver of return variance during the early part of an asset s life due to lack of analyst coverage lack of participation by quants etc assetCode is not consistent across time the same economic entity can and in many cases does have a different assetCode assetCode is not a permanent identifier assetName while consistent across time can refer to more than once stock at the same time and therefore cannot be used to make time series features assetName is not a unique permanent identifier Missing time series data does not show up as NaN on the trading calendar rather the rows are just missing As such to make time series features you have to be careful with pandas rolling calculations and roll on calendar days not naively on the count of rows  Make environment and get data Note the D and on time ", "id": "marketneutral/eda-security-master-analysis", "size": "9456", "language": "python", "html_url": "https://www.kaggle.com/code/marketneutral/eda-security-master-analysis", "git_url": "https://www.kaggle.com/code/marketneutral/eda-security-master-analysis"}